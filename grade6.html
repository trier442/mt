<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>초등 6학년 문해력 진단 - 대치 소피의 세계</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #0a0a1a;
            color: #e0e0e0;
        }
        .font-playfair { font-family: 'Playfair Display', serif; }
        .page-bg { background: radial-gradient(ellipse at top, #1b2735 0%, #090a0f 100%); }
        input[type="radio"]:checked + label {
            background-color: #c0a060;
            color: #111;
            border-color: #d4b070;
            font-weight: bold;
        }
        .correct .correct-answer-label { background-color: #22c55e; color: white; }
        .incorrect .user-answer-label { background-color: #ef4444; color: white; text-decoration: line-through; }
        .incorrect .correct-answer-label { border: 2px solid #22c55e; }
        #result-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); z-index: 40; }
        #result-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 50; max-height: 90vh; overflow-y: auto; }
        .choice-item { border: 2px solid rgba(255, 255, 255, 0.1); }
        .choice-item.selected { border-color: #c0a060; background-color: rgba(192, 160, 96, 0.1); }
    </style>
</head>
<body class="page-bg">

    <!-- Header -->
    <header class="fixed w-full z-30 bg-black/30 backdrop-blur-sm shadow-lg">
        <nav class="container mx-auto max-w-7xl px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold font-playfair text-white">SOPHIE'S WORLD</div>
            <a href="selection.html" class="border border-amber-500 text-amber-500 font-bold px-5 py-2 rounded-full hover:bg-amber-500 hover:text-gray-900 transition text-sm">학년 선택으로</a>
        </nav>
    </header>

    <div class="container mx-auto max-w-7xl p-4 pt-24">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- 문제 영역 -->
            <main class="lg:col-span-2 bg-black/20 p-6 rounded-lg shadow-lg border border-gray-800 overflow-y-auto" style="height: 85vh;">
                <div class="border-b border-gray-700 pb-4 mb-8">
                    <h1 class="text-2xl font-bold text-white">초등 6학년 문해력 진단평가</h1>
                    <p class="text-gray-400">총 20문항 | 제한 시간 30분</p>
                </div>
                <div id="questions-container" class="space-y-12"></div>
            </main>

            <!-- 답안지 영역 -->
            <aside class="bg-black/20 p-6 rounded-lg shadow-lg border border-gray-800">
                <h2 class="text-xl font-bold text-center border-b border-gray-700 pb-3 mb-4">빠른 답안지</h2>
                <div id="answer-sheet" class="space-y-3 max-h-[450px] overflow-y-auto pr-2"></div>
                <button id="grade-button" class="w-full mt-6 bg-amber-500 text-gray-900 font-bold py-3 rounded-lg hover:bg-amber-400 transition duration-300 text-lg">채점하기</button>
                <div id="result-display" class="hidden mt-4 text-center">
                    <p class="text-2xl font-bold" id="score-text"></p>
                    <button id="show-result-modal-btn" class="w-full mt-4 bg-green-600 text-white font-bold py-2 rounded-lg hover:bg-green-700">결과 분석 보기</button>
                </div>
            </aside>
        </div>
    </div>

    <!-- 결과 분석 모달 -->
    <div id="result-modal-overlay" class="hidden">
        <div id="result-modal" class="bg-gray-900 border border-amber-500/30 rounded-2xl w-11/12 max-w-2xl p-6 sm:p-8 shadow-2xl">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-gray-500 hover:text-white text-3xl font-bold">&times;</button>
            <h2 class="text-center text-3xl font-bold mb-2">총점 <span id="modal-total-score" class="text-amber-400"></span>점</h2>
            <div class="w-full max-w-md mx-auto my-4"><canvas id="result-chart"></canvas></div>
            <div class="bg-black/20 rounded-lg p-4 flex flex-wrap justify-around text-center shadow-inner gap-2">
                <div><span class="font-bold">어휘 </span><span id="vocab-score" class="text-amber-400 font-bold"></span>점</div>
                <div><span class="font-bold">추론 </span><span id="inference-score" class="text-amber-400 font-bold"></span>점</div>
                <div><span class="font-bold">정보 파악 </span><span id="info-score" class="text-amber-400 font-bold"></span>점</div>
            </div>
            <div class="text-center mt-6">
                <p id="assessment-text" class="text-lg"></p>
                <p id="recommendation-text" class="text-md text-gray-400 mt-1"></p>
            </div>
        </div>
    </div>

    <script>
        const quizData = {
            gradeName: "초등 6학년",
            totalQuestions: 20,
            data: [
                {
                    subject: '과학',
                    passage: '지구 온난화는 지구의 평균 기온이 점차 상승하는 현상을 말합니다. 주된 원인은 석탄, 석유와 같은 화석 연료 사용으로 인해 대기 중 이산화탄소 농도가 높아졌기 때문입니다. 이산화탄소는 지구 밖으로 나가야 할 열을 가두는 온실 효과를 일으킵니다. 지구 온난화가 지속되면 극지방의 빙하가 녹아 해수면이 상승하고, 기상 이변이 잦아져 생태계 전반에 심각한 위협이 됩니다. 이를 해결하기 위해 화석 연료 사용을 줄이고, 신재생에너지 개발과 에너지 효율 개선 등 전 지구적인 노력이 <u>시급합니다</u>.',
                    questions: [
                        { q: '1. 이 글에서 설명하는 지구 온난화의 주된 원인은?', choices: ['화산 폭발로 인한 화산재', '자연적인 기후 변화 주기', '화석 연료 사용으로 인한 이산화탄소 증가', '태양의 활동 변화', '산림의 면적 증가'], answer: 2, type: 'info' },
                        { q: '2. 지구 온난화로 인해 발생하는 결과가 아닌 것은?', choices: ['해수면 상승', '생태계 파괴', '잦은 기상 이변', '지구 평균 기온 하강', '극지방 빙하 감소'], answer: 3, type: 'info' },
                        { q: '3. 이 글의 내용을 바탕으로 우리가 실천할 수 있는 행동으로 가장 거리가 먼 것은?', choices: ['가까운 거리는 자전거를 이용한다.', '사용하지 않는 전등을 끈다.', '일회용품 대신 개인 컵을 사용한다.', '여름에 에어컨을 필요 이상으로 세게 튼다.', '재활용 쓰레기를 철저히 분리 배출한다.'], answer: 3, type: 'inference' },
                        { q: '4. 밑줄 친 ‘<u>시급합니다</u>’와 바꾸어 쓸 수 있는 가장 적절한 말은?', choices: ['재미있습니다', '불가능합니다', '오래 걸립니다', '매우 급합니다', '이해가 어렵습니다'], answer: 3, type: 'vocabulary' }
                    ]
                },
                {
                    subject: '사회',
                    passage: '조선 후기, 실학은 성리학의 형식적인 틀에서 벗어나 백성의 삶에 실질적인 도움을 주는 학문을 연구하자는 움직임에서 시작되었습니다. 정약용, 박제가 등 여러 실학자는 농업 생산력을 높이는 방법, 상공업을 발전시키는 방안, 새로운 기술의 도입 등을 주장했습니다. 그들은 토지 제도를 개혁하여 농민의 부담을 덜어주고, 청나라의 발전된 문물을 적극적으로 받아들여 나라를 부강하게 만들어야 한다고 생각했습니다. 비록 실학자들의 주장이 당시 정치에 모두 반영되지는 못했지만, 그들의 생각은 근대 사회로 나아가는 중요한 밑거름이 되었습니다.',
                    questions: [
                        { q: '5. 이 글에서 설명하는 ‘실학’의 특징으로 가장 옳은 것은?', choices: ['성리학의 이론을 더욱 강화하는 학문', '백성의 삶과 무관한 형이상학적 탐구', '현실 문제 해결을 중시하는 실용적 학문', '외국의 문물을 무조건 배척하는 학문', '오직 농업 기술 발전에만 집중한 학문'], answer: 2, type: 'info' },
                        { q: '6. 실학자들이 주장한 내용이 아닌 것은?', choices: ['토지 제도 개혁', '상공업 진흥', '청나라의 선진 문물 수용', '성리학적 질서의 강화', '새로운 기술 도입'], answer: 3, type: 'info' },
                        { q: '7. 실학이 등장하게 된 배경으로 가장 적절한 것을 추론하시오.', choices: ['백성들의 생활이 매우 풍족했기 때문에', '기존의 학문이 현실 문제 해결에 도움을 주지 못했기 때문에', '전쟁에서 승리하여 나라가 안정되었기 때문에', '다른 나라와의 교류가 완전히 끊겼기 때문에', '왕이 강력한 힘으로 새로운 학문을 장려했기 때문에'], answer: 1, type: 'inference' },
                        { q: '8. 이 글의 내용으로 보아, 실학자들이 꿈꾸었던 사회의 모습은?', choices: ['모두가 똑같이 가난한 사회', '엄격한 신분 질서가 유지되는 사회', '백성의 삶이 안정되고 나라의 힘이 강한 사회', '상업을 억제하고 농업만 중시하는 사회', '외부 세계와 단절된 고립된 사회'], answer: 2, type: 'inference' }
                    ]
                },
                {
                    subject: '인문',
                    passage: '모든 사람은 태어날 때부터 자유롭고 존엄하며, 평등한 권리를 가진다. 이는 ‘인권’이라 불리며, 누구도 다른 사람의 인권을 침해할 수 없다. 하지만 역사 속에서는 성별, 인종, 종교, 신분 등을 이유로 다른 사람의 인권을 억압하는 일이 비일비재했다. 이러한 차별과 억압에 맞서 수많은 사람이 싸운 결과, 오늘날 인권은 대부분의 국가에서 헌법을 통해 보장되는 보편적 가치로 자리 잡게 되었다. 그렇다고 인권 문제가 완전히 해결된 것은 아니다. 지금도 세계 곳곳에서는 다양한 형태의 인권 침해가 발생하고 있으며, 모든 사람의 인권이 존중받는 사회를 만들기 위한 노력은 계속되어야 한다.',
                    questions: [
                        { q: '9. 이 글에서 설명하는 ‘인권’의 특징이 아닌 것은?', choices: ['태어날 때부터 주어지는 권리', '모든 사람에게 평등하게 적용되는 권리', '특정 국가의 국민에게만 주어지는 권리', '다른 사람이 함부로 침해할 수 없는 권리', '인간으로서 존엄하게 살아갈 권리'], answer: 2, type: 'info' },
                        { q: '10. 역사 속에서 인권이 침해되었던 이유로 언급되지 않은 것은?', choices: ['성별', '인종', '나이', '종교', '신분'], answer: 2, type: 'info' },
                        { q: '11. 이 글의 마지막 문단이 강조하는 바로 가장 적절한 것은?', choices: ['인권 문제는 이제 완전히 해결되었다.', '인권은 법으로만 보장하면 충분하다.', '과거의 인권 침해 사례를 잊어야 한다.', '인권은 저절로 지켜지는 것이 아니므로 지속적인 관심과 노력이 필요하다.', '인권보다 국가의 발전을 우선해야 한다.'], answer: 3, type: 'inference' },
                        { q: '12. 밑줄 친 ‘<u>비일비재했다</u>’는 어떤 의미인가?', choices: ['거의 일어난 적이 없었다', '단 한 번만 일어났다', '매우 드물게 일어났다', '흔하게 자주 일어났다', '일어날 가능성이 전혀 없었다'], answer: 3, type: 'vocabulary' }
                    ]
                },
                {
                    subject: '예술',
                    passage: '‘민화’는 조선 시대 서민층에서 유행했던 그림으로, 주로 이름 없는 화가들이 그렸습니다. 민화는 정해진 형식에 얽매이지 않고 자유롭고 솔직한 표현이 특징입니다. 해, 달, 산, 동물, 꽃 등 주변의 친숙한 소재를 사용하였으며, 그림마다 복을 기원하고 나쁜 것을 물리치고자 하는 소망이 담겨 있습니다. 예를 들어, 호랑이 그림은 나쁜 기운을 막아주고, 책이나 문방구를 그린 ‘책가도’는 학문적 성공을 기원하는 의미를 가집니다. 민화는 비록技巧(기교)적으로 뛰어나지는 않을지라도, 우리 조상들의 소박한 삶의 모습과 염원을 엿볼 수 있는 소중한 문화유산입니다.',
                    questions: [
                        { q: '13. 이 글의 내용과 일치하지 않는 것은?', choices: ['민화는 주로 이름 없는 서민 화가들이 그렸다.', '정해진 형식에 얽매이지 않은 자유로운 표현이 특징이다.', '민화는 주로 왕이나 양반들의 주문을 받아 제작되었다.', '그림에는 복을 기원하는 소망이 담겨 있다.', '책가도는 학문적 성공을 바라는 의미를 담고 있다.'], answer: 2, type: 'info' },
                        { q: '14. 사람들이 ‘책가도’를 집에 걸어 두었던 이유로 가장 타당한 것은?', choices: ['집안을 화려하게 장식하기 위해', '책이 매우 비쌌기 때문에', '자녀가 학문으로 성공하기를 바랐기 때문에', '그림 실력을 뽐내기 위해', '나쁜 귀신을 쫓아내기 위해'], answer: 2, type: 'inference' },
                        { q: '15. 밑줄 친 ‘<u>技巧(기교)</u>’의 의미로 가장 적절한 것은?', choices: ['재료의 품질', '그림의 크기', '꾸미어 나타내는 솜씨나 기술', '그림의 가격', '그림의 주제'], answer: 2, type: 'vocabulary' },
                        { q: '16. 민화가 소중한 문화유산으로 평가받는 이유는 무엇인가?', choices: ['세계적으로 가장 비싼 그림이기 때문에', '조선 시대 서민들의 삶과 소망을 엿볼 수 있기 때문에', '유명한 왕의 초상화를 많이 그렸기 때문에', '현대 화가들이 가장 많이 따라 그리는 그림이기 때문에', '금이나 보석 같은 비싼 재료를 사용했기 때문에'], answer: 1, type: 'inference' }
                    ]
                },
                 {
                    subject: '융합',
                    passage: '오늘날 우리는 인공위성 덕분에 편리한 생활을 누리고 있습니다. 내비게이션은 GPS 위성이 보내는 신호를 받아 자동차의 현재 위치를 정확히 알려줍니다. 일기 예보는 기상 위성이 촬영한 구름 사진과 각종 데이터를 분석하여 만들어집니다. 위성 방송을 통해 세계 곳곳의 TV 프로그램을 실시간으로 볼 수도 있습니다. 이처럼 인공위성은 통신, 방송, 교통, 기상 관측 등 우리 생활과 밀접한 다양한 분야에서 핵심적인 역할을 수행하고 있습니다. 우주에 떠 있는 작은 인공위성 하나가 전 세계를 하나로 묶고, 우리의 삶을 더욱 풍요롭게 만들고 있는 것입니다.',
                    questions: [
                        { q: '17. 이 글에서 언급된 인공위성의 활용 분야가 아닌 것은?', choices: ['교통', '기상', '통신', '의료', '방송'], answer: 3, type: 'info' },
                        { q: '18. 내비게이션이 현재 위치를 알 수 있는 원리는 무엇인가?', choices: ['기상 위성의 구름 사진 분석', '지상 기지국과의 통신', 'GPS 위성이 보내는 신호 수신', '자동차 바퀴의 회전수 계산', '운전자의 목소리 인식'], answer: 2, type: 'info' },
                        { q: '19. 이 글의 제목으로 가장 적절한 것은?', choices: ['인공위성을 만드는 방법', '최초의 인공위성, 스푸트니크', '우주 전쟁과 인공위성', '우리 생활을 바꾸는 인공위성의 힘', '인공위성으로 인한 우주 쓰레기 문제'], answer: 3, type: 'inference' },
                        { q: '20. 위 글을 바탕으로 미래 사회의 모습을 상상한 것 중 가장 거리가 먼 것은?', choices: ['더욱 정확하고 빠른 길 안내가 가능해질 것이다.', '세계 어느 곳에서든 끊김 없는 인터넷 사용이 가능해질 것이다.', '자연재해를 예측하는 정확도가 더욱 높아질 것이다.', '인공위성을 이용한 범죄가 완전히 사라질 것이다.', '우주 탐사를 위한 더 정밀한 관측이 이루어질 것이다.'], answer: 3, type: 'inference' }
                    ]
                }
            ]
        };

        const questionsContainer = document.getElementById('questions-container');
        const answerSheet = document.getElementById('answer-sheet');
        const gradeButton = document.getElementById('grade-button');
        const resultDisplay = document.getElementById('result-display');
        const scoreText = document.getElementById('score-text');
        const showResultModalBtn = document.getElementById('show-result-modal-btn');
        const modalOverlay = document.getElementById('result-modal-overlay');
        const closeModalBtn = document.getElementById('close-modal-btn');
        
        let userAnswers = new Array(quizData.totalQuestions).fill(null);
        let resultChartInstance = null;

        function initializeQuiz() {
            let questionCounter = 0;
            quizData.data.forEach(section => {
                let sectionHtml = `<section>
                    <h3 class="text-xl font-bold text-amber-400 border-l-4 border-amber-400 pl-3 mb-4">${section.subject} [${questionCounter + 1}~${questionCounter + section.questions.length}]</h3>
                    <div class="bg-black/20 p-5 rounded-lg mb-6 text-gray-300 leading-relaxed border border-gray-800">${section.passage.replace(/<u>(.*?)<\/u>/g, '<u class="text-amber-400 no-underline font-semibold">$1</u>')}</div>
                    <div class="space-y-8">`;
                section.questions.forEach(q => {
                    questionCounter++;
                    q.q = q.q.replace(/^\d+\./, `${questionCounter}.`);
                    sectionHtml += `<div class="question-block" id="q-block-${questionCounter}">
                        <p class="font-bold text-lg mb-4 text-gray-200">${q.q.replace(/<u>(.*?)<\/u>/g, '<u class="text-amber-400 no-underline font-semibold">$1</u>')}</p><div class="space-y-2">`;
                    q.choices.forEach((choice, choiceIndex) => {
                        sectionHtml += `<div class="choice-item p-3 rounded-lg hover:bg-amber-500/10 hover:border-amber-500 cursor-pointer" data-q="${questionCounter}" data-a="${choiceIndex}">
                            <span class="font-bold mr-2 text-amber-500">${choiceIndex + 1}</span><span class="text-gray-300">${choice}</span></div>`;
                    });
                    sectionHtml += `</div></div>`;
                    
                    let answerSheetHtml = `<div class="flex items-center justify-between p-2 rounded-md" id="as-q-${questionCounter}">
                        <span class="font-bold text-gray-400">${questionCounter}번</span><div class="flex space-x-1">`;
                    q.choices.forEach((_, choiceIndex) => {
                        answerSheetHtml += `<input type="radio" name="q${questionCounter}" id="q${questionCounter}a${choiceIndex}" value="${choiceIndex}" class="hidden">
                        <label for="q${questionCounter}a${choiceIndex}" class="flex items-center justify-center w-8 h-8 rounded-full border-2 border-gray-600 cursor-pointer hover:bg-gray-700 text-gray-400 transition-colors">${choiceIndex + 1}</label>`;
                    });
                    answerSheetHtml += `</div></div>`;
                    answerSheet.innerHTML += answerSheetHtml;
                });
                sectionHtml += `</div></section>`;
                questionsContainer.innerHTML += sectionHtml;
            });
        }
        
        function createRadarChart(userScores, avgScores) {
            const ctx = document.getElementById('result-chart').getContext('2d');
            if (resultChartInstance) resultChartInstance.destroy();
            resultChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['정보 파악 능력', '추론 능력', '어휘 능력'],
                    datasets: [{
                        label: '나의 점수', data: userScores,
                        backgroundColor: 'rgba(192, 160, 96, 0.2)', borderColor: 'rgba(192, 160, 96, 1)',
                        borderWidth: 2, pointBackgroundColor: 'rgba(192, 160, 96, 1)'
                    }, {
                        label: '평균', data: avgScores,
                        backgroundColor: 'rgba(107, 114, 128, 0.2)', borderColor: 'rgba(107, 114, 128, 1)',
                        borderWidth: 2, pointBackgroundColor: 'rgba(107, 114, 128, 1)'
                    }]
                },
                options: {
                    scales: { r: {
                        angleLines: { color: 'rgba(255, 255, 255, 0.2)' },
                        grid: { color: 'rgba(255, 255, 255, 0.2)' },
                        suggestedMin: 0, suggestedMax: 10,
                        pointLabels: { font: { size: 14, weight: 'bold' }, color: '#e0e0e0' },
                        ticks: { backdropColor: 'rgba(0, 0, 0, 0.5)', color: '#e0e0e0', stepSize: 2 }
                    }},
                    plugins: { legend: { labels: { color: '#e0e0e0' } } }
                }
            });
        }
        
        function gradeQuiz() {
            let scores = { info: 0, inference: 0, vocabulary: 0 };
            let totals = { info: 0, inference: 0, vocabulary: 0 };
            let totalCorrect = 0;
            let qNum = 0;

            quizData.data.forEach(section => {
                section.questions.forEach(q => {
                    qNum++;
                    totals[q.type]++;
                    const userAnswer = userAnswers[qNum - 1];
                    const isCorrect = userAnswer === q.answer;
                    
                    document.getElementById(`as-q-${qNum}`).querySelectorAll('input[type="radio"]').forEach(r => r.disabled = true);
                    const userAnswerLabel = document.querySelector(`#as-q-${qNum} label[for="q${qNum}a${userAnswer}"]`);
                    const correctAnswerLabel = document.querySelector(`#as-q-${qNum} label[for="q${qNum}a${q.answer}"]`);

                    if (isCorrect) {
                        totalCorrect++; scores[q.type]++;
                        document.getElementById(`as-q-${qNum}`).classList.add('correct');
                    } else {
                        document.getElementById(`as-q-${qNum}`).classList.add('incorrect');
                        if (userAnswerLabel) userAnswerLabel.classList.add('user-answer-label');
                    }
                    if (correctAnswerLabel) correctAnswerLabel.classList.add('correct-answer-label');
                });
            });

            scoreText.textContent = `총 ${quizData.totalQuestions}문제 중 ${totalCorrect}문제 정답!`;
            resultDisplay.classList.remove('hidden');
            
            document.getElementById('modal-total-score').textContent = totalCorrect;
            document.getElementById('info-score').textContent = scores.info;
            document.getElementById('inference-score').textContent = scores.inference;
            document.getElementById('vocab-score').textContent = scores.vocabulary;

            const achievementRate = totalCorrect / quizData.totalQuestions;
            let level, recommendation;
            if (achievementRate < 0.4) { level = '하'; recommendation = '기초부터 차근차근, 3~4단계 교재로 시작하는 것이 좋습니다.'; }
            else if (achievementRate < 0.8) { level = '중'; recommendation = '현재 수준을 유지하며, 5단계 교재로 심화 학습을 시작해 보세요.'; }
            else { level = '상'; recommendation = '훌륭합니다! 6단계 이상의 고난도 문제로 실력을 키워나가세요.'; }
            document.getElementById('assessment-text').innerHTML = `테스트 결과, 성취도 <span class="text-red-500 font-bold">${Math.round(achievementRate * 100)}%</span>로<br>문해력 수준은 <span class="font-playfair text-amber-400">${quizData.gradeName}</span> 평균 대비 <span class="text-red-500 font-bold">${level}</span> 수준입니다.`;
            document.getElementById('recommendation-text').textContent = recommendation;
            
            const userChartScores = [(scores.info / (totals.info || 1)) * 10, (scores.inference / (totals.inference || 1)) * 10, (scores.vocabulary / (totals.vocabulary || 1)) * 10];
            createRadarChart(userChartScores, [5, 5, 5]);
        }

        questionsContainer.addEventListener('click', (e) => {
            const choiceDiv = e.target.closest('.choice-item');
            if (choiceDiv && !gradeButton.disabled) {
                const qNum = choiceDiv.dataset.q;
                const aNum = choiceDiv.dataset.a;
                document.getElementById(`q${qNum}a${aNum}`).click();
            }
        });

        answerSheet.addEventListener('change', (e) => {
            if (e.target.type === 'radio') {
                const qNum = parseInt(e.target.name.substring(1));
                userAnswers[qNum - 1] = parseInt(e.target.value);
                document.querySelectorAll(`#q-block-${qNum} .choice-item`).forEach(item => item.classList.remove('selected'));
                document.querySelector(`#q-block-${qNum} .choice-item[data-a="${userAnswers[qNum-1]}"]`).classList.add('selected');
            }
        });

        gradeButton.addEventListener('click', () => {
            if (userAnswers.includes(null)) {
                alert('모든 문제에 답해주세요.');
                return;
            }
            gradeButton.disabled = true;
            gradeButton.textContent = '채점 완료';
            gradeButton.classList.add('bg-gray-500', 'cursor-not-allowed');
            gradeQuiz();
        });
        
        showResultModalBtn.addEventListener('click', () => modalOverlay.classList.remove('hidden'));
        closeModalBtn.addEventListener('click', () => modalOverlay.classList.add('hidden'));
        modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) modalOverlay.classList.add('hidden'); });

        initializeQuiz();
    </script>
</body>
</html>
